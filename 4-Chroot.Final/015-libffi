# Final System: libffi
# Build under chroot

# Configure source. If host and target are the same machine,
# use  -with-gcc-arch=native instead
# Refer to:
# https://gcc.gnu.org/onlinedocs/gcc-9.2.0/gcc/x86-Options.html
case $(uname -m) in
 x86_64) export ARCH="x86-64"
         export TUPLE="x86_64-pc-linux-musl"
         ;;
 i686)   export ARCH="i686"
         export TUPLE="i686-pc-linux-musl"
         ;;
 armv7l) export ARCH="armv7-a"
         export TUPLE="armv7l-pc-linux-musleabihf"
         ;;
 armv6l) export ARCH="armv6"
         export TUPLE="armv6l-pc-linux-musleabihf"
         ;;
 aarch64) export ARCH="armv8-a"
          export TUPLE="aarch64-pc-linux-musleabihf"
         ;;
esac

CC=$CC CXX=$CCX         \
./configure --prefix=/usr    \
            --disable-static \
            --includedir=/usr/include    \
            --disable-multi-os-directory \
            --with-pic --with-gcc-arch=$ARCH \
            --build=$TUPLE \
            --enable-pax_emutramp \
            --enable-portable-binary \
            --disable-exec-static-tramp
unset ARCH TUPLE

# Build and install
make && make install
