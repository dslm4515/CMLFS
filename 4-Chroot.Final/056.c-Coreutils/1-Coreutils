# Final System: GNU Coreutils
# Build under chroot

# Update the build system of the source:
patch -Np1 -i ../patches/update_coreutils-9.1_autoconf.patch

# Suppress a test which on some machines can loop forever
sed -i '/test.lock/s/^/#/' gnulib-tests/gnulib.mk

# Configure
CC=clang CXX=clang++     \
ac_cv_func_syncfs=no     \
FORCE_UNSAFE_CONFIGURE=1 \
LIBS="-lutmps -lskarnet" \
./configure --prefix=/usr                           \
            --enable-no-install-program=kill,uptime \
            --disable-rpath                         \
            --enable-install-program=arch,hostname

# Build and install
FORCE_UNSAFE_CONFIGURE=1 make && make install
