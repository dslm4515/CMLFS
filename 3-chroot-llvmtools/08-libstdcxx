# llvmtools Chain: GCC's libstdc++
# Build and install as cmlfs

# The target build is finding the host libstdc++'s <fenv.h>, fix it
# https://gcc.gnu.org/bugzilla/show_bug.cgi?id=100017#c7
#patch -Np1 -i ../patches/gcc-mlfs-11.2.0/fix_fenv_header.patch

# Build in a dedicated directory
mkdir -v build && cd build

# Set the build flags
export  CARGS="--prefix=/llvmtools "
export CARGS+="--with-gxx-include-dir=/llvmtools/include/c++/12.2.0 "

# Disable features not needed in chroot
export CARGS+="--disable-libstdcxx-threads "
export CARGS+="--disable-libstdcxx-pch "
export CARGS+="--disable-multilib "
export CARGS+="--disable-nls "

# Configure will expect cpp in /lib:
 ln -sv /llvmtools/bin/cpp /lib/cpp

# Configure the source
CC=${TUPLE}-gcc CXX=${TUPLE}-g++ \
../libstdc++-v3/configure ${CARGS} \
--target=x86_64-linux-musl --host=x86_64-pc-linux-musl \
--build=x86_64-linux-musl

# Build
make

# Install
make install

unset CARGS
