# Stripping & Clean up
# This step is optional, but if the CMLFS partition
# is rather small, it is beneficial to learn that
# unnecessary items can be removed. The executables
# and libraries built so far contain about 70 MB
# of unneeded debugging symbols.

# Exit the chroot to safely strip binaries and
# libraries in use under the chroot:
exit

# Make sure the CMLFS variable is still set:
echo $CMLFS

# Find the target tuple
export TUPLE=$(/llvmtools/bin/clang --version | grep Target | cut -d " " -f 2)

# Remove debug symbols with:
find /llvmtools/lib/ -maxdepth 1 -type f -exec /cgnutools/bin/strip.gnu --strip-debug {} \;
find /llvmtools/lib/${TUPLE} -maxdepth 1 -type f -exec /cgnutools/bin/strip.gnu --strip-debug {} \;
find /llvmtools/lib/gcc/${TUPLE}/12.2.0 -maxdepth 1 -type f -exec /cgnutools/bin/strip.gnu --strip-debug {} \;
find /llvmtools/bin/ -maxdepth 1 -type f -exec /usr/bin/strip --strip-unneeded {} \;
find /llvmtools/libexec/gcc/${TUPLE}/12.2.0 -maxdepth 1 -type f -exec /cgnutools/bin/strip.gnu --strip-unneeded {} \;

# Remove the documentation:
rm -rf /llvmtools/{,share}/{info,man,doc}

# Remove unneeded files:
find /llvmtools/{lib,libexec} -name \*.la -delete
