# llvmtools: Ncurses
# Build and install as cmlfs

# Ensure that gawk is found first during configuration:
sed -i s/mawk// configure

# Run the following commands to build the “tic” program
# on the build host:
mkdir build
pushd build
  ../configure
  make -C include
  make -C progs tic
popd

# Configure source with clang
CC=$CC CXX=$CXX \
AR=llvm-ar \
AS=llvm-as \
RANLIB=llvm-ranlib \
LD=ld.lld \
STRIP=llvm-strip \
./configure --prefix=/llvmtools \
            --build=${TARGET_TUPLE} \
            --host=${TARGET_TUPLE} \
            --with-shared   \
            --without-debug \
            --without-ada   \
            --enable-widec  \
            --enable-overwrite --with-cxx-shared --without-normal

# Build and install to toolchain
make &&
make TIC_PATH=$(pwd)/build/progs/tic install

# Bash build expects to find libcurses.so:
ln -sv libncursesw.so.6.3 /llvmtools/lib/libcurses.so

# ccmake (CMake) expects libtinfow.so, create a
# link for it:
ln -sv  libncursesw.so.6.3 /llvmtools/lib/libtinfow.so

# Building stage1 LLD will look for a missing library:
ln -sv  libncursesw.so.6.3 /llvmtools/lib/libterminfo.so

# Fix the binaries to use the dynamic loader/linker/interpreter:
for b in clear infocmp tabs tic toe tput tset
do
setDL /llvmtools/bin/$b
done
